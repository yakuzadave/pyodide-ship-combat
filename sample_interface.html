---
type: combat
subtype: ship-combat
---


```python


class Ship:
    def __init__(self, name, ai_personality, systems):
        self.name = name
        self.ai_personality = ai_personality
        self.systems = systems
        self.hull_integrity = 100
        self.shield_strength = 100
        self.power_reserves = 100
        self.structural_integrity = 100
        self.life_support_efficiency = 100
        self.navigation_accuracy = 100
        self.weapons = systems.get("weapons", "None")

    def add_weapon(self, weapon):
        if self.weapons == "None":
            self.weapons = []
        self.weapons.append(weapon)
    def take_damage(self, damage):
        if self.shield_strength > 0:
            absorbed = min(self.shield_strength, damage)
            self.shield_strength -= absorbed
            damage -= absorbed
            print(f"{self.name} ({self.ai_personality}): Shields absorbed {absorbed} damage.")
        if damage > 0:
            self.hull_integrity -= damage
            print(f"{self.name} ({self.ai_personality}): Hull took {damage} damage.")
        if self.hull_integrity <= 0:
            print(f"{self.name} ({self.ai_personality}): Hull integrity compromised! Ship destroyed.")
    def repair(self, amount):
        self.hull_integrity = min(100, self.hull_integrity + amount)
        print(f"{self.name} ({self.ai_personality}): Hull repaired by {amount}. Current integrity: {self.hull_integrity}")
    def repair_shields(self, amount):
        self.shield_strength = min(100, self.shield_strength + amount)
        print(f"{self.name} ({self.ai_personality}): Shields repaired by {amount}. Current strength: {self.shield_strength}")

    def attack(self, target):
        if not self.weapons or self.power_reserves < 10:
            print(f"{self.name} ({self.ai_personality}): Cannot attack. Insufficient weapons or power.")
            return
        weapon = self.weapons[0]  # Simplification: always use the first weapon
        damage = weapon["damage"] + random.randint(-2, 2)  # Add some randomness
        self.power_reserves -= 10
        print(f"{self.name} ({self.ai_personality}): Attacking {target.name} with {weapon['name']} for {damage} damage.")
        target.take_damage(damage)
    def recharge_power(self, amount):
        self.power_reserves = min(100, self.power_reserves + amount)
        print(f"{self.name} ({self.ai_personality}): Power reserves recharged by {amount}. Current reserves: {self.power_reserves}")

    def status_report(self):
        print(f"Status Report for {self.name} ({self.ai_personality}):")
        print(f"  Hull Integrity: {self.hull_integrity}")
        print(f"  Shield Strength: {self.shield_strength}")
        print(f"  Power Reserves: {self.power_reserves}")
        print(f"  Structural Integrity: {self.structural_integrity}")
        print(f"  Life Support Efficiency: {self.life_support_efficiency}")
        print(f"  Navigation Accuracy: {self.navigation_accuracy}")
        print(f"  Weapons: {', '.join([w['name'] for w in self.weapons]) if self.weapons != 'None' else 'None'}")
        print()
    def is_destroyed(self):
        return self.hull_integrity <= 0

    def is_operational(self):
        return not self.is_destroyed() and self.shield_strength > 0 and self.power_reserves > 0 and self.structural_integrity > 0 and self.life_support_efficiency > 0 and self.navigation_accuracy > 0 and self.weapons != "None"
    
    

    def __repr__(self):
        return f"<Ship {self.name} ({self.ai_personality})>"

# From YAML ship.stats
hull_integrity = 78
shield_strength = 65
power_reserves = 82
structural_integrity = 91
life_support_efficiency = 94

# System-specific values
engine_efficiency = 87
engine_fuel = 72
sensor_efficiency = 68
shield_strength_system = 65
weapons_primary_count = 2
weapons_secondary_count = 4
missiles_remaining = 12
airlock_integrity = 78

# Example: ship AI
ai_personality = "Efficient but occasionally sarcastic"


```

```python

import rolldice
import random

def ai_flavor(ai, event, system):
    # Just a bit of AI banter
    if event == "offline":
        if "sarcastic" in ai:
            return f"Good thing you weren't using {system}, Captain."
        return f"Recommend immediate attention to {system}."
    elif event == "degrade":
        if "sarcastic" in ai:
            return f"I hope you like the challenge of half-working {system}."
        return f"{system.title()} efficiency now suboptimal."
    elif event == "cascade":
        return f"Multiple failures detected in {system}."
    return ""
```

```python

def system_status_block(name, efficiency=None):
    return {"status": "Operational", "efficiency": efficiency if efficiency is not None else 100}

def random_system(systems):
    choices = [k for k, v in systems.items() if v["status"] != "Offline"]
    return random.choice(choices) if choices else None

def parse_roll_result(result):
    """Defensive parsing: ensures result is always a number."""
    if isinstance(result, (int, float)):
        return result
    try:
        return int(result)
    except Exception:
        try:
            return float(result)
        except Exception:
            return 0
```



```python




def roll_and_explain(expr, label):
    result, explanation = rolldice.roll_dice(expr)
    parsed = parse_roll_result(result)
    print(f"{label} Roll: {expr}")
    print(f"Result: {parsed}")
    print(f"Explanation: {explanation}")
    print()
    return parsed

def system_stress_check(ship, ai_persona):
    roll, explanation = rolldice.roll_dice("1d10")
    roll = parse_roll_result(roll)
    affected = random_system(ship["systems"])
    if not affected:
        print(f"{ship['name']} ({ai_persona}): All critical systems already offline. Only hull remains!")
        return
    sys = ship["systems"][affected]
    if roll <= 2:
        sys["status"] = "Offline"
        sys["efficiency"] = 0
        print(f"{ship['name']} ({ai_persona}): {affected.upper()} has gone OFFLINE! {ai_flavor(ai_persona, 'offline', affected)}")
    elif roll <= 5:
        if sys["status"] != "Offline":
            old = sys["efficiency"]
            sys["efficiency"] = max(0, old - 15)
            if sys["efficiency"] == 0:
                sys["status"] = "Offline"
                print(f"{ship['name']} ({ai_persona}): {affected.upper()} degraded past thresholdâ€”now OFFLINE! {ai_flavor(ai_persona, 'cascade', affected)}")
            else:
                sys["status"] = "Degraded"
                print(f"{ship['name']} ({ai_persona}): {affected.upper()} degraded to {sys['efficiency']}%! {ai_flavor(ai_persona, 'degrade', affected)}")
    else:
        print(f"{ship['name']} ({ai_persona}): All systems maintain integrity this time.")

def attack(attacker, defender):
    print(f"--- {attacker['name']} attacks {defender['name']} ---")
    pulse_total = roll_and_explain(f"2d20+{attacker['weapons']}", "Pulse Cannon Attack")
    if pulse_total > 28:
        print("Pulse cannons HIT! Rolling shield check...")
        shield_roll = roll_and_explain("1d100", "Shield Block")
        if shield_roll <= defender["shield"]:
            print("Shields absorb the blast!")
        else:
            print("Shields FAIL! Hull is hit.")
            damage = roll_and_explain("2d10", "Hull Damage")
            defender["hull"] = max(defender["hull"] - damage, 0)
            print(f"{defender['name']} hull now at {defender['hull']}%")
            defender["shield"] = max(defender["shield"] - 10, 0)
            print(f"{defender['name']} shield drops to {defender['shield']}%")
            system_stress_check(defender, defender['ai'])
    else:
        print("Pulse cannons MISS!")

    # Missile Attack (50% chance)
    if attacker["missiles"] > 0 and random.random() < 0.5:
        print("Attempting missile launch...")
        missile_roll = roll_and_explain("1d12", "Missile Launch")
        if missile_roll <= attacker["missiles"]:
            attacker["missiles"] -= 1
            print("Missile launched!")
            shield_roll = roll_and_explain("1d100", "Missile Shield Block")
            if shield_roll > defender["shield"]:
                print("Missile strikes the hull!")
                damage = roll_and_explain("3d8", "Missile Hull Damage")
                defender["hull"] = max(defender["hull"] - damage, 0)
                print(f"{defender['name']} hull now at {defender['hull']}%")
                defender["shield"] = max(defender["shield"] - 15, 0)
                print(f"{defender['name']} shield drops to {defender['shield']}%")
                system_stress_check(defender, defender['ai'])
            else:
                print("Missile intercepted by shields!")
        else:
            print("No missile launch (roll failed or out of missiles).")
    else:
        print("No missile fired this round.")
    print()  # spacing

def report_systems(ship):
    print(f"{ship['name']} Systems:")
    for name, sys in ship['systems'].items():
        print(f" - {name.title()}: {sys['status']} ({sys['efficiency']}%)")
    print()

# === Ship definitions ===

aurora = {
    "name": "Aurora Huntress",
    "hull": 78,
    "shield": 65,
    "weapons": 2,
    "missiles": 12,
    "crew": 2,
    "systems": {
        "engines": system_status_block("engines", 87),
        "shields": system_status_block("shields", 65),
        "sensors": system_status_block("sensors", 68),
        "weapons": system_status_block("weapons", 100),
        "life_support": system_status_block("life_support", 94),
        "navigation": system_status_block("navigation", 100),
        "communications": system_status_block("communications", 100),
    },
    "ai": "Efficient but occasionally sarcastic",
}

horizon = {
    "name": "Black Horizon",
    "hull": 85,
    "shield": 70,
    "weapons": 3,
    "missiles": 10,
    "crew": 4,
    "systems": {
        "engines": system_status_block("engines", 79),
        "shields": system_status_block("shields", 70),
        "sensors": system_status_block("sensors", 75),
        "weapons": system_status_block("weapons", 100),
        "life_support": system_status_block("life_support", 88),
        "navigation": system_status_block("navigation", 100),
        "communications": system_status_block("communications", 100),
    },
    "ai": "Blunt and tactical",
}

# === Combat Simulation ===

for round_num in range(1, 4):
    print(f"\n=== ROUND {round_num} ===\n")
    attack(aurora, horizon)
    if horizon["hull"] <= 0:
        print(f"{horizon['name']} has been destroyed! Combat ends.")
        break
    attack(horizon, aurora)
    if aurora["hull"] <= 0:
        print(f"{aurora['name']} has been destroyed! Combat ends.")
        break

def battle_summary(ship):
    print(f"{ship['name']} - Hull: {ship['hull']}%, Shield: {ship['shield']}%, Missiles: {ship['missiles']}")
    report_systems(ship)

print("\nFINAL STATUS:")
battle_summary(aurora)
battle_summary(horizon)



```



```python


import random
import rolldice

# --- Flavor Tables ---
BATTLE_ORDERS = [
    "Brace for Impact", "Lock On", "All Power to Shields", "Reload Ordnance",
    "Boarding Party", "Fire Everything"
]

CRITICAL_HITS = [
    "Fire in engine room",
    "Shields overloaded",
    "Life support damaged",
    "Weapon mount destroyed",
    "Bridge hit: Leadership -2",
    "Communications blackout",
    "Navigation disabled",
    "Power core breach",
    "Secondary explosion",
    "Catastrophic hull breach"
]

BOARDING_RESULTS = [
    "Boarders repelled with heavy losses",
    "Boarders gain foothold, minor damage to defender",
    "Defender's crew surrenders key systems",
    "Boarders cause fires and damage, then withdraw",
    "Engine room sabotaged by boarders",
    "Command deck breached! Ship in chaos",
    "Boarders wiped out by security counterattack"
]

FIRE_EVENTS = [
    "Fire breaks out in crew quarters",
    "Fire damages life support",
    "Fire suppressed by automated systems",
    "Fire spreads to ammo magazineâ€”danger!"
]

EXPLOSION_EVENTS = [
    "Secondary explosion in engineering",
    "Weapons battery explodes, hull breach",
    "Contained explosion, minimal damage",
    "Chain reaction threatens power core!"
]

# --- Helpers ---
def parse_roll_result(result):
    if isinstance(result, (int, float)):
        return result
    try:
        return int(result)
    except Exception:
        try:
            return float(result)
        except Exception:
            return 0

def roll_and_explain(expr, label):
    result, explanation = rolldice.roll_dice(expr)
    parsed = parse_roll_result(result)
    print(f"{label} Roll: {expr}  -->  {parsed}")
    print(f"Explanation: {explanation}")
    print()
    return parsed

def ai_flavor(ai, event, system):
    if event == "offline":
        if "sarcastic" in ai:
            return f"Good thing you weren't using {system}, Captain."
        return f"Recommend immediate attention to {system}."
    elif event == "degrade":
        if "sarcastic" in ai:
            return f"I hope you like the challenge of half-working {system}."
        return f"{system.title()} efficiency now suboptimal."
    elif event == "cascade":
        return f"Multiple failures detected in {system}."
    return ""

def system_status_block(efficiency=None):
    return {"status": "Operational", "efficiency": efficiency if efficiency is not None else 100}

def random_system(systems):
    choices = [k for k, v in systems.items() if v["status"] != "Offline"]
    return random.choice(choices) if choices else None

# --- Ship Data Model ---
def new_ship(name, hull, shield, weapons, missiles, crew, leadership, boarding_strength, systems, ai):
    return {
        "name": name,
        "hull": hull,
        "shield": shield,
        "weapons": weapons,
        "missiles": missiles,
        "crew": crew,
        "leadership": leadership,
        "boarding_strength": boarding_strength,
        "systems": systems.copy(),
        "ai": ai,
        "order": None,
        "range": "standard",  # 'long', 'standard', 'close'
    }

aurora = new_ship(
    "Aurora Huntress", 78, 65, 2, 12, 2, 7, 1,
    {
        "engines": system_status_block(87),
        "shields": system_status_block(65),
        "sensors": system_status_block(68),
        "weapons": system_status_block(100),
        "life_support": system_status_block(94),
        "navigation": system_status_block(100),
        "communications": system_status_block(100),
    },
    "Efficient but occasionally sarcastic"
)

horizon = new_ship(
    "Black Horizon", 85, 70, 3, 10, 4, 8, 2,
    {
        "engines": system_status_block(79),
        "shields": system_status_block(70),
        "sensors": system_status_block(75),
        "weapons": system_status_block(100),
        "life_support": system_status_block(88),
        "navigation": system_status_block(100),
        "communications": system_status_block(100),
    },
    "Blunt and tactical"
)

# --- Battle Phase Logic ---

def choose_order(ship):
    ship['order'] = random.choice(BATTLE_ORDERS)
    print(f"{ship['name']} issues order: {ship['order']}")

def apply_order_modifiers(ship, roll_type):
    mod = 0
    if ship['order'] == "Lock On" and roll_type == "attack":
        mod += 4
    if ship['order'] == "All Power to Shields":
        if roll_type == "defense":
            mod += 15
        if roll_type == "attack":
            mod -= 2
    if ship['order'] == "Brace for Impact" and roll_type == "defense":
        mod += 0  # handled separately in damage
    return mod

def system_stress_check(ship):
    roll = random.randint(1, 10)
    affected = random_system(ship["systems"])
    if not affected:
        print(f"{ship['name']} ({ship['ai']}): All critical systems already offline. Only hull remains!")
        return
    sys = ship["systems"][affected]
    if roll <= 2:
        sys["status"] = "Offline"
        sys["efficiency"] = 0
        print(f"{ship['name']} ({ship['ai']}): {affected.upper()} has gone OFFLINE! {ai_flavor(ship['ai'], 'offline', affected)}")
    elif roll <= 5:
        if sys["status"] != "Offline":
            old = sys["efficiency"]
            sys["efficiency"] = max(0, old - 15)
            if sys["efficiency"] == 0:
                sys["status"] = "Offline"
                print(f"{ship['name']} ({ship['ai']}): {affected.upper()} degraded past thresholdâ€”now OFFLINE! {ai_flavor(ship['ai'], 'cascade', affected)}")
            else:
                sys["status"] = "Degraded"
                print(f"{ship['name']} ({ship['ai']}): {affected.upper()} degraded to {sys['efficiency']}%! {ai_flavor(ship['ai'], 'degrade', affected)}")
    else:
        print(f"{ship['name']} ({ship['ai']}): All systems maintain integrity this time.")

def critical_hit_check(defender, hull_damage):
    if hull_damage >= 15 or random.randint(1, 20) == 20:
        critical = random.choice(CRITICAL_HITS)
        print(f"**CRITICAL HIT!** {defender['name']} suffers: {critical}")
        # System effects by type (optional)
        if "Fire" in critical:
            fire = random.choice(FIRE_EVENTS)
            print(f"    Fire event: {fire}")
        elif "explosion" in critical.lower():
            explosion = random.choice(EXPLOSION_EVENTS)
            print(f"    Explosion event: {explosion}")
        elif "boarding" in critical.lower():
            print(f"    Boarders rampage! More chaos.")

def resolve_attack(attacker, defender):
    atk_mod = apply_order_modifiers(attacker, "attack")
    def_mod = apply_order_modifiers(defender, "defense")
    pulse_expr = f"2d20+{attacker['weapons']}+{atk_mod}"
    pulse_total = roll_and_explain(pulse_expr, "Pulse Cannon Attack")
    if pulse_total > 28:
        print("Pulse cannons HIT! Rolling shield check...")
        shield_roll = roll_and_explain(f'1d100+{def_mod}', "Shield Block")
        if shield_roll <= defender["shield"] + def_mod:
            print("Shields absorb the blast!")
        else:
            print("Shields FAIL! Hull is hit.")
            damage = roll_and_explain("2d10", "Hull Damage")
            if defender['order'] == "Brace for Impact":
                print("Brace for Impact reduces damage by half!")
                damage = int(damage / 2)
            defender["hull"] = max(defender["hull"] - damage, 0)
            print(f"{defender['name']} hull now at {defender['hull']}%")
            defender["shield"] = max(defender["shield"] - 10, 0)
            print(f"{defender['name']} shield drops to {defender['shield']}%")
            system_stress_check(defender)
            critical_hit_check(defender, damage)
    else:
        print("Pulse cannons MISS!")

def missile_phase(attacker, defender):
    if attacker["missiles"] > 0 and attacker['order'] != "Reload Ordnance":
        if random.random() < 0.5:
            print(f"{attacker['name']} fires a missile!")
            missile_roll = roll_and_explain("1d12", "Missile Launch")
            if missile_roll <= attacker["missiles"]:
                attacker["missiles"] -= 1
                print("Missile launched!")
                shield_roll = roll_and_explain("1d100", "Missile Shield Block")
                if shield_roll > defender["shield"]:
                    print("Missile strikes the hull!")
                    damage = roll_and_explain("3d8", "Missile Hull Damage")
                    if defender['order'] == "Brace for Impact":
                        print("Brace for Impact reduces missile damage by half!")
                        damage = int(damage / 2)
                    defender["hull"] = max(defender["hull"] - damage, 0)
                    print(f"{defender['name']} hull now at {defender['hull']}%")
                    defender["shield"] = max(defender["shield"] - 15, 0)
                    print(f"{defender['name']} shield drops to {defender['shield']}%")
                    system_stress_check(defender)
                    critical_hit_check(defender, damage)
                else:
                    print("Missile intercepted by shields!")
            else:
                print("Missile launch failed (bad luck or ammo).")
        else:
            print("No missile fired this round.")
    elif attacker['order'] == "Reload Ordnance":
        print(f"{attacker['name']} reloads ordnance: +2 missiles")
        attacker['missiles'] += 2

def boarding_action(attacker, defender):
    if attacker['range'] != 'close' or attacker['order'] != "Boarding Party":
        return
    print(f"*** Boarding action! {attacker['name']} attempts to board {defender['name']}! ***")
    attack_score = roll_and_explain(f"1d6+{attacker['crew']}+{attacker['boarding_strength']}", "Boarding Roll (attacker)")
    defense_score = roll_and_explain(f"1d6+{defender['crew']}", "Boarding Roll (defender)")
    if attack_score > defense_score:
        event = random.choice(BOARDING_RESULTS)
        print(f"Boarding success: {event}")
        defender["hull"] = max(defender["hull"] - 5, 0)
        critical_hit_check(defender, 10)
    else:
        print("Boarders repelled! Countermeasures hold.")

def report_systems(ship):
    print(f"{ship['name']} Systems:")
    for name, sys in ship['systems'].items():
        print(f" - {name.title()}: {sys['status']} ({sys['efficiency']}%)")
    print()

def battle_summary(ship):
    print(f"{ship['name']} - Hull: {ship['hull']}%, Shield: {ship['shield']}%, Missiles: {ship['missiles']}")
    report_systems(ship)

# --- Combat Simulation Main Loop ---
for round_num in range(1, 4):
    print(f"\n=== ROUND {round_num} ===\n")
    choose_order(aurora)
    choose_order(horizon)

    # Movement: abstract, can randomize closing to 'close' for boarding
    for ship in [aurora, horizon]:
        if random.random() < 0.3:
            ship['range'] = 'close'
            print(f"{ship['name']} closes to point-blank range!")
        else:
            ship['range'] = 'standard'

    resolve_attack(aurora, horizon)
    if horizon["hull"] <= 0:
        print(f"{horizon['name']} has been destroyed! Combat ends.")
        break
    resolve_attack(horizon, aurora)
    if aurora["hull"] <= 0:
        print(f"{aurora['name']} has been destroyed! Combat ends.")
        break

    missile_phase(aurora, horizon)
    if horizon["hull"] <= 0:
        print(f"{horizon['name']} has been destroyed by missile fire! Combat ends.")
        break
    missile_phase(horizon, aurora)
    if aurora["hull"] <= 0:
        print(f"{aurora['name']} has been destroyed by missile fire! Combat ends.")
        break

    boarding_action(aurora, horizon)
    if horizon["hull"] <= 0:
        print(f"{horizon['name']} has been disabled by boarders! Combat ends.")
        break
    boarding_action(horizon, aurora)
    if aurora["hull"] <= 0:
        print(f"{aurora['name']} has been disabled by boarders! Combat ends.")
        break

print("\nFINAL STATUS:")
battle_summary(aurora)
battle_summary(horizon)


```


```python



# --- BATTLEFLAVORS & TABLES ---

BATTLE_ORDERS = [
    "Brace for Impact", "Lock On", "All Power to Shields", "Reload Ordnance",
    "Boarding Party", "Fire Everything"
]

CRITICAL_HITS = [
    "Fire in engine room",
    "Shields overloaded",
    "Life support damaged",
    "Weapon mount destroyed",
    "Bridge hit: Leadership -2",
    "Communications blackout",
    "Navigation disabled",
    "Power core breach",
    "Secondary explosion",
    "Catastrophic hull breach"
]

BOARDING_RESULTS = [
    "Boarders repelled with heavy losses",
    "Boarders gain foothold, minor damage to defender",
    "Defender's crew surrenders key systems",
    "Boarders cause fires and damage, then withdraw",
    "Engine room sabotaged by boarders",
    "Command deck breached! Ship in chaos",
    "Boarders wiped out by security counterattack"
]

FIRE_EVENTS = [
    "Fire breaks out in crew quarters",
    "Fire damages life support",
    "Fire suppressed by automated systems",
    "Fire spreads to ammo magazineâ€”danger!"
]

EXPLOSION_EVENTS = [
    "Secondary explosion in engineering",
    "Weapons battery explodes, hull breach",
    "Contained explosion, minimal damage",
    "Chain reaction threatens power core!"
]

HAZARDS = [
    "Asteroid Field", "Ion Storm", "Nebula", "Solar Flare", "Radiation Surge", "None"
]
```



```python


import random
import rolldice


# --- HELPERS ---

def parse_roll_result(result):
    if isinstance(result, (int, float)):
        return result
    try:
        return int(result)
    except Exception:
        try:
            return float(result)
        except Exception:
            return 0

def roll_and_explain(expr, label):
    result, explanation = rolldice.roll_dice(expr)
    parsed = parse_roll_result(result)
    print(f"{label} Roll: {expr}  -->  {parsed}")
    # Optionally, print explanation for detailed logs
    # print(f"Explanation: {explanation}")
    return parsed

def ai_flavor(ai, event, system):
    if event == "offline":
        if "sarcastic" in ai:
            return f"Good thing you weren't using {system}, Captain."
        return f"Recommend immediate attention to {system}."
    elif event == "degrade":
        if "sarcastic" in ai:
            return f"I hope you like the challenge of half-working {system}."
        return f"{system.title()} efficiency now suboptimal."
    elif event == "cascade":
        return f"Multiple failures detected in {system}."
    return ""

def system_status_block(efficiency=None):
    return {"status": "Operational", "efficiency": efficiency if efficiency is not None else 100}

def random_system(systems):
    choices = [k for k, v in systems.items() if v["status"] != "Offline"]
    return random.choice(choices) if choices else None

def new_ship(name, hull, shield, weapons, missiles, crew, leadership, boarding_strength, systems, ai):
    return {
        "name": name,
        "hull": hull,
        "shield": shield,
        "weapons": weapons,
        "missiles": missiles,
        "crew": crew,
        "leadership": leadership,
        "boarding_strength": boarding_strength,
        "systems": {k: v.copy() for k, v in systems.items()},
        "ai": ai,
        "order": None,
        "range": "standard",
    }

def report_systems(ship):
    print(f"{ship['name']} Systems:")
    for name, sys in ship['systems'].items():
        print(f" - {name.title()}: {sys['status']} ({sys['efficiency']}%)")
    print()
```

```python


def battle_summary(ship):
    print(f"{ship['name']} - Hull: {ship['hull']}%, Shield: {ship['shield']}%, Missiles: {ship['missiles']}")
    report_systems(ship)

def select_order(ship):
    ship['order'] = random.choice(BATTLE_ORDERS)
    print(f"{ship['name']} issues order: {ship['order']}")


def apply_order_modifiers(ship, roll_type):
    mod = 0
    if ship['order'] == "Lock On" and roll_type == "attack":
        mod += 4
    if ship['order'] == "All Power to Shields":
        if roll_type == "defense":
            mod += 15
        if roll_type == "attack":
            mod -= 2
    return mod

def system_stress_check(ship):
    roll = random.randint(1, 10)
    affected = random_system(ship["systems"])
    if not affected:
        print(f"{ship['name']} ({ship['ai']}): All critical systems already offline. Only hull remains!")
        return
    sys = ship["systems"][affected]
    if roll <= 2:
        sys["status"] = "Offline"
        sys["efficiency"] = 0
        print(f"{ship['name']} ({ship['ai']}): {affected.upper()} has gone OFFLINE! {ai_flavor(ship['ai'], 'offline', affected)}")
    elif roll <= 5:
        if sys["status"] != "Offline":
            old = sys["efficiency"]
            sys["efficiency"] = max(0, old - 15)
            if sys["efficiency"] == 0:
                sys["status"] = "Offline"
                print(f"{ship['name']} ({ship['ai']}): {affected.upper()} degraded past thresholdâ€”now OFFLINE! {ai_flavor(ship['ai'], 'cascade', affected)}")
            else:
                sys["status"] = "Degraded"
                print(f"{ship['name']} ({ship['ai']}): {affected.upper()} degraded to {sys['efficiency']}%! {ai_flavor(ship['ai'], 'degrade', affected)}")
    else:
        print(f"{ship['name']} ({ship['ai']}): All systems maintain integrity this time.")

def critical_hit_check(defender, hull_damage):
    if hull_damage >= 15 or random.randint(1, 20) == 20:
        critical = random.choice(CRITICAL_HITS)
        print(f"**CRITICAL HIT!** {defender['name']} suffers: {critical}")
        if "Fire" in critical:
            fire = random.choice(FIRE_EVENTS)
            print(f"    Fire event: {fire}")
            system_stress_check(defender)
        elif "explosion" in critical.lower():
            explosion = random.choice(EXPLOSION_EVENTS)
            print(f"    Explosion event: {explosion}")
            system_stress_check(defender)
        elif "life support" in critical.lower():
            defender["systems"]["life_support"]["status"] = "Offline"
        elif "shields" in critical.lower():
            defender["systems"]["shields"]["status"] = "Offline"
            defender["shield"] = 0
        elif "power core" in critical.lower():
            defender["hull"] = max(defender["hull"] - 20, 0)
            print(f"    Massive damage: Hull -20!")
        elif "catastrophic" in critical.lower():
            defender["hull"] = max(defender["hull"] - 30, 0)
            print(f"    Catastrophic breach: Hull -30!")
        elif "navigation" in critical.lower():
            defender["systems"]["navigation"]["status"] = "Offline"
        elif "comms" in critical.lower():
            defender["systems"]["communications"]["status"] = "Offline"
        elif "weapon" in critical.lower():
            defender["systems"]["weapons"]["status"] = "Offline"
            defender["weapons"] = 0
        elif "bridge" in critical.lower():
            defender["leadership"] = max(defender["leadership"] - 2, 0)
            print(f"    Bridge hit: Leadership reduced!")
        else:
            system_stress_check(defender)

def resolve_attack(attacker, defender):
    atk_mod = apply_order_modifiers(attacker, "attack")
    def_mod = apply_order_modifiers(defender, "defense")
    pulse_expr = f"2d20+{attacker['weapons']}+{atk_mod}"
    pulse_total = roll_and_explain(pulse_expr, f"{attacker['name']} Pulse Cannon Attack")
    if pulse_total > 28:
        print("Pulse cannons HIT! Rolling shield check...")
        shield_roll = roll_and_explain(f'1d100+{def_mod}', f"{defender['name']} Shield Block")
        if shield_roll <= defender["shield"] + def_mod:
            print("Shields absorb the blast!")
        else:
            print("Shields FAIL! Hull is hit.")
            damage = roll_and_explain("2d10", "Hull Damage")
            if defender['order'] == "Brace for Impact":
                print("Brace for Impact reduces damage by half!")
                damage = int(damage / 2)
            defender["hull"] = max(defender["hull"] - damage, 0)
            print(f"{defender['name']} hull now at {defender['hull']}%")
            defender["shield"] = max(defender["shield"] - 10, 0)
            print(f"{defender['name']} shield drops to {defender['shield']}%")
            system_stress_check(defender)
            critical_hit_check(defender, damage)
    else:
        print("Pulse cannons MISS!")

def missile_phase(attacker, defender):
    if attacker["missiles"] > 0 and attacker['order'] != "Reload Ordnance":
        if random.random() < 0.5:
            print(f"{attacker['name']} fires a missile!")
            missile_roll = roll_and_explain("1d12", "Missile Launch")
            if missile_roll <= attacker["missiles"]:
                attacker["missiles"] -= 1
                print("Missile launched!")
                shield_roll = roll_and_explain("1d100", "Missile Shield Block")
                if shield_roll > defender["shield"]:
                    print("Missile strikes the hull!")
                    damage = roll_and_explain("3d8", "Missile Hull Damage")
                    if defender['order'] == "Brace for Impact":
                        print("Brace for Impact reduces missile damage by half!")
                        damage = int(damage / 2)
                    defender["hull"] = max(defender["hull"] - damage, 0)
                    print(f"{defender['name']} hull now at {defender['hull']}%")
                    defender["shield"] = max(defender["shield"] - 15, 0)
                    print(f"{defender['name']} shield drops to {defender['shield']}%")
                    system_stress_check(defender)
                    critical_hit_check(defender, damage)
                else:
                    print("Missile intercepted by shields!")
            else:
                print("Missile launch failed (bad luck or ammo).")
        else:
            print(f"{attacker['name']}: No missile fired this round.")
    elif attacker['order'] == "Reload Ordnance":
        print(f"{attacker['name']} reloads ordnance: +2 missiles")
        attacker['missiles'] += 2

def boarding_action(attacker, defender):
    if attacker['range'] != 'close' or attacker['order'] != "Boarding Party":
        return
    print(f"*** Boarding action! {attacker['name']} attempts to board {defender['name']}! ***")
    attack_score = roll_and_explain(f"1d6+{attacker['crew']}+{attacker['boarding_strength']}", "Boarding Roll (attacker)")
    defense_score = roll_and_explain(f"1d6+{defender['crew']}", "Boarding Roll (defender)")
    if attack_score > defense_score:
        event = random.choice(BOARDING_RESULTS)
        print(f"Boarding success: {event}")
        defender["hull"] = max(defender["hull"] - 5, 0)
        critical_hit_check(defender, 10)
    else:
        print("Boarders repelled! Countermeasures hold.")

def attempt_repairs(ship):
    if ship["hull"] <= 0: return
    for name, sys in ship["systems"].items():
        if sys["status"] in ("Degraded", "Offline"):
            dc = 10 if sys["status"] == "Degraded" else 15
            roll = roll_and_explain(f"1d12+{ship['leadership']}", f"Repair {name.title()}")
            if roll >= dc:
                sys["status"] = "Operational"
                sys["efficiency"] = 100
                print(f"{ship['name']}: {name.title()} repaired to Operational!")
            else:
                print(f"{ship['name']}: {name.title()} repair failed.")

def apply_hazard(fleet):
    hazard = random.choice(HAZARDS)
    print(f"\n--- ENVIRONMENTAL HAZARD: {hazard} ---")
    for ship in fleet:
        if ship["hull"] <= 0: continue
        if hazard == "Asteroid Field":
            nav_roll = roll_and_explain("1d20+5", "Asteroid Navigation")
            if nav_roll < 12:
                print(f"{ship['name']} struck by debris! Hull -8, random system degraded.")
                ship['hull'] = max(ship['hull'] - 8, 0)
                system_stress_check(ship)
        elif hazard == "Ion Storm":
            print(f"{ship['name']}: Ionized! Shields -10, 50% system glitch.")
            ship['shield'] = max(ship['shield'] - 10, 0)
            if random.random() < 0.5:
                sys = random_system(ship["systems"])
                if sys:
                    ship["systems"][sys]["status"] = "Offline"
                    print(f"{ship['name']}: {sys.upper()} fritzed by ion storm!")
        elif hazard == "Nebula":
            print(f"{ship['name']}: Sensors degraded, missile reliability halved this round.")
            ship["systems"]["sensors"]["status"] = "Degraded"
        elif hazard == "Solar Flare":
            sys = random_system(ship["systems"])
            if sys:
                ship["systems"][sys]["status"] = "Offline"
                print(f"{ship['name']}: {sys.upper()} fried by solar flare!")
            if random.random() < 0.5:
                ship["systems"]["communications"]["status"] = "Offline"
                print(f"{ship['name']}: Communications jammed by solar flare!")
        elif hazard == "Radiation Surge":
            print(f"{ship['name']}: Radiation surge! Life support stress.")
            if random.random() < 0.5:
                ship["systems"]["life_support"]["status"] = "Degraded"
        else:
            print(f"{ship['name']}: No effect this round.")

# ---- FLEET SETUP ----

fleet = [
    new_ship(
        "Aurora Huntress", 78, 65, 2, 12, 2, 7, 1,
        {
            "engines": system_status_block(87),
            "shields": system_status_block(65),
            "sensors": system_status_block(68),
            "weapons": system_status_block(100),
            "life_support": system_status_block(94),
            "navigation": system_status_block(100),
            "communications": system_status_block(100),
        },
        "Efficient but occasionally sarcastic"
    ),
    new_ship(
        "Black Horizon", 85, 70, 3, 10, 4, 8, 2,
        {
            "engines": system_status_block(79),
            "shields": system_status_block(70),
            "sensors": system_status_block(75),
            "weapons": system_status_block(100),
            "life_support": system_status_block(88),
            "navigation": system_status_block(100),
            "communications": system_status_block(100),
        },
        "Blunt and tactical"
    ),
    new_ship(
        "Celestial Warden", 90, 80, 2, 14, 3, 9, 2,
        {
            "engines": system_status_block(80),
            "shields": system_status_block(80),
            "sensors": system_status_block(70),
            "weapons": system_status_block(100),
            "life_support": system_status_block(90),
            "navigation": system_status_block(100),
            "communications": system_status_block(100),
        },
        "Formal and calculating"
    )
]

MAX_ROUNDS = 10

# ---- MAIN COMBAT LOOP ----

alive_ships = [ship for ship in fleet if ship["hull"] > 0]

for round_num in range(1, MAX_ROUNDS + 1):
    print(f"\n=== ROUND {round_num} ===\n")
    # 1. Orders Phase
    for ship in alive_ships:
        select_order(ship)

    # 2. Environmental Hazard Phase
    apply_hazard(alive_ships)

    # 3. Combat Phases (Shooting, Missiles, Boarding)
    current_alive = [s for s in alive_ships if s["hull"] > 0]
    for attacker in current_alive:
        targets = [s for s in current_alive if s is not attacker and s["hull"] > 0]
        if not targets: continue
        defender = random.choice(targets)
        print(f"\n{attacker['name']} targets {defender['name']}:")
        resolve_attack(attacker, defender)
        if defender["hull"] <= 0:
            print(f"{defender['name']} has been destroyed!")
            alive_ships = [s for s in alive_ships if s["hull"] > 0]

    for attacker in alive_ships:
        targets = [s for s in alive_ships if s is not attacker and s["hull"] > 0]
        if not targets: continue
        defender = random.choice(targets)
        missile_phase(attacker, defender)
        if defender["hull"] <= 0:

```

```python

fleet = [
    new_ship(
        "Aurora Huntress", 78, 65, 2, 12, 2, 7, 1,
        {
            "engines": system_status_block(87),
            "shields": system_status_block(65),
            "sensors": system_status_block(68),
            "weapons": system_status_block(100),
            "life_support": system_status_block(94),
            "navigation": system_status_block(100),
            "communications": system_status_block(100),
        },
        "Efficient but occasionally sarcastic"
    ),
    new_ship(
        "Black Horizon", 85, 70, 3, 10, 4, 8, 2,
        {
            "engines": system_status_block(79),
            "shields": system_status_block(70),
            "sensors": system_status_block(75),
            "weapons": system_status_block(100),
            "life_support": system_status_block(88),
            "navigation": system_status_block(100),
            "communications": system_status_block(100),
        },
        "Blunt and tactical"
    ),
    new_ship(
        "Celestial Warden", 90, 80, 2, 14, 3, 9, 2,
        {
            "engines": system_status_block(80),
            "shields": system_status_block(80),
            "sensors": system_status_block(70),
            "weapons": system_status_block(100),
            "life_support": system_status_block(90),
            "navigation": system_status_block(100),
            "communications": system_status_block(100),
        },
        "Formal and calculating"
    )
]

MAX_ROUNDS = 10

# ---- MAIN COMBAT LOOP ----

alive_ships = [ship for ship in fleet if ship["hull"] > 0]

for round_num in range(1, MAX_ROUNDS + 1):
    print(f"\n=== ROUND {round_num} ===\n")
    # 1. Orders Phase
    for ship in alive_ships:
        select_order(ship)

    # 2. Environmental Hazard Phase
    apply_hazard(alive_ships)

    # 3. Combat Phases (Shooting, Missiles, Boarding)
    current_alive = [s for s in alive_ships if s["hull"] > 0]
    for attacker in current_alive:
        targets = [s for s in current_alive if s is not attacker and s["hull"] > 0]
        if not targets:
            continue
        defender = random.choice(targets)
        print(f"\n{attacker['name']} targets {defender['name']}:")
        resolve_attack(attacker, defender)
        if defender["hull"] <= 0:
            print(f"{defender['name']} has been destroyed!")
            alive_ships = [s for s in alive_ships if s["hull"] > 0]

    for attacker in alive_ships:
        targets = [s for s in alive_ships if s is not attacker and s["hull"] > 0]
        if not targets:
            continue
        defender = random.choice(targets)
        missile_phase(attacker, defender)
        if defender["hull"] <= 0:
            print(f"{defender['name']} has been destroyed by missile fire!")
            alive_ships = [s for s in alive_ships if s["hull"] > 0]

    # Movement/range: randomly close to 'close' for boarding
    for ship in alive_ships:
        ship['range'] = 'close' if random.random() < 0.3 else 'standard'

    for attacker in alive_ships:
        targets = [s for s in alive_ships if s is not attacker and s["hull"] > 0]
        if not targets:
            continue
        defender = random.choice(targets)
        boarding_action(attacker, defender)
        if defender["hull"] <= 0:
            print(f"{defender['name']} has been disabled by boarders!")
            alive_ships = [s for s in alive_ships if s["hull"] > 0]

    # 4. Repair Phase
    for ship in alive_ships:
        attempt_repairs(ship)

    # End if only one ship left
    if len(alive_ships) <= 1:
        print("\n--- Only one ship remains. Battle is over! ---")
        break

# ---- FINAL STATUS REPORT ----

print("\nFINAL STATUS:")
for ship in fleet:
    battle_summary(ship)
```
